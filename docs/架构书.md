
# 《恩言大字版》圣经 App 架构白皮书 (v2026.1)

## 一、 产品命名建议

针对老年群体，名字需要传递**“清晰”、“陪伴”、“恩典”**的感觉，且要直观。

* **首选方案：【恩言大字版】(Grace Words)**
* *理由*：“恩言”出自圣经（路加福音 4:22），寓意美好；“大字版”直接点出功能痛点，让老年人一眼就能在应用商店识别。


* **备选方案：【松柏听经】(Pine Audio Bible)**
* *理由*：“松柏”在中国文化中象征长寿与长者，“听经”强调了核心的音频功能。



---

## 二、 总体技术栈 (Tech Stack)

采用 **Flutter (Dart)** 单代码库开发，实现 iOS 与 Android 100% 代码复用。

| 模块 | 选型技术 | 核心理由 |
| --- | --- | --- |
| **框架** | **Flutter 3.x** | 完美的 UI 渲染能力，优秀的音频后台处理生态。 |
| **架构模式** | **Clean Architecture + BLoC** | 业务逻辑与 UI 彻底分离，极易维护和扩展。 |
| **依赖注入** | **GetIt + Injectable** | 实现模块解耦（例如：随时替换播放器内核而不影响 UI）。 |
| **本地数据库** | **SQLite (sqflite)** | 存储经文文本、搜索索引、用户笔记。 |
| **音频内核** | **Just Audio + Audio Service** | 支持后台播放、锁屏控制、缓存流媒体。 |
| **下载管理** | **Dio + Background Downloader** | 支持断点续传、后台下载、WiFi 检测。 |
| **KV 存储** | **Shared Preferences** | 存储字号设置、阅读进度、夜间模式开关。 |

---

## 三、 系统架构设计 (System Architecture)

系统采用 **分层架构 (Layered Architecture)**，确保“内容数据”与“界面展示”不耦合。

### 1. 数据层 (Data Layer) - 基础设施

这一层负责“搬运数据”，不管是来自本地还是网络，对上层透明。

* **Database Schema (SQLite 设计)**：
* `versions` 表：支持多译本扩展（id: 1=和合本, id: 2=新译本...）。
* `books` 表：书卷元数据（书名、简称、章节数）。
* `verses` 表：经文核心数据（`book_id`, `chapter`, `verse`, `text`, `version_id`）。
* *预埋优化*：文本直接内置在 App 安装包的 `assets` 中，首次启动复制到 SQLite，保证**无网也能看字**。


* **Media Repository (媒体仓库)**：
* **逻辑判定**：UI 请求播放时，Rep 检查 `/{book}/{chapter}.mp3` 是否在本地。
* **存在** -> 返回本地 `FileSource`。
* **不存在** -> 返回网络 `UrlSource` 并触发后台缓存队列。



### 2. 领域层 (Domain Layer) - 纯业务逻辑

这一层定义 App “该怎么运作”，不包含任何 Flutter UI 代码。

* **Entities**：`BibleChapter`, `PlayStatus`, `DownloadQueue`。
* **Use Cases (用例)**：
* `GetChapterTextUseCase`: 获取经文。
* `SyncAudioUseCase`: 在 WiFi 环境下同步音频。
* `AutoCleanupUseCase`: 当手机空间不足时，自动清理 30 天前听过的缓存。



### 3. 表现层 (Presentation Layer) - 用户界面

这一层只负责“画图”和“接收触控”。

* **Reader Page (阅读页)**：
* 监听 `ScrollController`，配合音频时间戳实现“自动滚屏”。
* **字体缩放引擎**：不使用系统字号，而是 App 内部维护一个 `double fontSizeMultiplier`，范围 1.0 - 2.5 倍。


* **Player Controls (播放控件)**：
* **大按钮设计**：播放/暂停按钮直径至少 64dp。
* **触感反馈**：操作成功触发 `HapticFeedback.mediumImpact()`。



---

## 四、 核心功能与 UX 细节（针对老年人优化）

### 1. “智能离线”策略 (Smart Offline)

不要让老年人去理解“下载管理”这样复杂的概念。

* **设计**：在“我的”页面，做一个大的开关 —— **“仅在 WiFi 下自动下载全书”**（默认开启）。
* **逻辑**：
* 当连接 WiFi 时，后台服务悄悄启动 `DownloadWorker`，按顺序下载《新约》->《旧约》。
* 下载完成的章节，目录旁显示一个小小的“绿色实心圆”。
* 如果切换到 4G/5G，立即暂停下载并保存断点。



### 2. 极致简化的 UI 交互

* **层级扁平化**：
* 首页就是九宫格样式的**“书卷选择”**（大方块，不用细列表）。
* 点击书卷 -> 弹出**大数字**选择章节。
* 进入阅读页 -> 直接开始读。


* **视觉增强**：
* **配色**：使用暖色调（#FFF8E1 羊皮纸色）作为默认背景，纯黑字体（#212121）。
* **行距**：默认 `height: 1.8`，避免行与行挤在一起，防止老花眼看串行。


* **防误触**：
* 隐藏不常用的功能（如分享、书签、笔记）到二级菜单，主屏幕只保留“听”、“读”、“字号调节”。



---

## 五、 数据源与版权方案

1. **文本 (Text)**：
* **CUV (和合本)**：使用 Public Domain 版本。
* *获取方式*：GitHub 开源 JSON/SQL 库。


2. **音频 (Audio)**：
* **API 接入**：申请 **Bible Brain (Faith Comes By Hearing)** 的 API Key。
* *配置化*：在 App 代码中维护一个 `config.json`，存储音频的 BaseURL。如果 API 变动，通过 Firebase Remote Config 远程下发新的 BaseURL，无需重新发版。



---

## 六、 项目开发路线图 (Roadmap)

1. **Phase 1: 骨架搭建 (Week 1-2)**
* 搭建 Flutter 基础架构，配置 SQLite 数据库，导入和合本经文。
* 实现最基础的“选书 -> 选章 -> 显示文字”流程。


2. **Phase 2: 音频与播放 (Week 3-4)**
* 接入 `just_audio`。
* 实现“边听边存”的缓存逻辑。
* 完成锁屏播放和通知栏控制。


3. **Phase 3: 老年化适配 (Week 5)**
* 实现全局字体无极缩放。
* 调整 UI 配色和点击热区（Touch Area）。
* 加入震动反馈。


4. **Phase 4: 批量下载与发布 (Week 6)**
* 实现后台批量下载服务。
* 接入 Firebase Crashlytics（监控崩溃）。
* 打包上架 App Store 和 Google Play。



---

### 给开发者的最后建议：

**“少即是多（Less is More）”。**
对于《恩言大字版》，每一个增加的功能（如笔记、高亮、分享）都可能是老年人的使用障碍。请务必保持**“打开即读，点击即听”**的极简初心。祝您的项目顺利上线！